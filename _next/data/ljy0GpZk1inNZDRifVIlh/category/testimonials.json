{"pageProps":{"posts":[{"title":"How new YerevaNN researchers use Aim to compare 100s of models","date":"2022-05-24T20:38:42.407Z","author":"Gev Soghomonian","description":"YerevaNN is a non-profit computer science and mathematics research lab based in Yerevan, Armenia. The lab’s main research interests are focused around machine learning algorithms […]","slug":"how-new-yerevann-researchers-use-aim-to-compare-100s-of-models","image":"https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lnmBXL_nhBGxOvjNO56-Rw.png","draft":false,"categories":["Testimonials"],"body":{"raw":"[YerevaNN](https://yerevann.com/) is a non-profit computer science and mathematics research lab based in Yerevan, Armenia. The lab’s main research interests are focused around machine learning algorithms and model selection, machine learning for biomedical data. YerevaNN also spends significant effort on supervision of student projects in order to support the up and coming Armenian scholars.\n\nYerevaNN collaborates with USC on DARPA grant projects — focused on low-resource learning problems, as well as with Meta AI for biomedical research, few-shot learning research. The lab has publications at Nature Scientific Data, ACL, NeurIPS, CVPR and WMT among others.\n\nWe traditionally onboard new teammates with a task to reproduce a well-known paper. This allows us to both introduce our internal systems, codebase, resources as well as a great leeway into the problems they are going to focus on as part of their research. This is a story about how Knarik Mheryan has gotten started at YerevaNN and how [Aim](https://github.com/aimhubio/aim) has helped her in the process.\n\n## The challenges\n\n### Model selection for cross-lingual transfer\n\nDeep learning has enabled high-accuracy solutions to a wide variety of NLP tasks.These models are trained primarily on English corpora. Thus, they aren’t readily applicable or available for other human languages (due to the lack of labeled data). \n\nOne approach to solve this problem is to pre-train a model on an unlabeled multilingual dataset in an unsupervised fashion. Then fine-tune it only on English labeled data for the given NLP task. It turns out the model’s performance on the target languages is strong, even though the model is fine-tuned only on English data.\n\nModel selection is a crucial step in this approach. When fine-tuning on English data with different hyperparams and seeds we are left with a set of models. The challenge is to select the model with the highest performance (e.g. F1 score) in the target language. \n\nIn 2021, Yang Chen and Alan Ritter, have published a [paper](https://arxiv.org/abs/2010.06127) in EMNLP that tries to address this problem. Therefore, Knarik Mheryan’s first task at YerevaNN has been to reproduce this work as part of the [ML Reproducibility Challenge 2021](https://paperswithcode.com/rc2021).\n\n### Reproducing the study\n\nA common tactic has been to select models that perform well on the English data. This paper shows that the accuracy of models on English data does not always correlate well with the target language performance. To reproduce this, we have fine-tuned 240 models on a Named Entity Recognition task.\n\nThe dimensionality of these experiments is high. So analyzing several 100 models is not a trivial task and it can take hours when comparing them with traditional tools. At YerevaNN we have been using [Aim](https://aimstack.io/aim-foundations-why-we-re-building-a-tensorboard-alternative/) as it allows us to compare 1000s of high-dimensional (all metrics, hyperparams and other metadata) experiments in a few clicks.\n\n## The solution\n\n### Using Params Explorer to compare models\n\nParams explorer allows us to directly compare the models with one view and with a few clicks. We have tracked the F1 scores for all models, languages. Using Aim’s [context](https://aimstack.readthedocs.io/en/latest/understanding/concepts.html?highlight=context#sequence-context) makes it easy to add additional metadata to the metrics (such as lang=”fr”) so there is no need to bake that data into the name. \n\nWe have selected two hyperparameters of interest and F1 scores of 5 languages of interest. This one view shows all the models (each curve is a model) at once and we can compare them relative to selected hyperparams and metrics. (see Figure 1)\n\nMore importantly, the plot below shows that the best performing model on English data (F1 lang=”en”) certainly doesn’t perform well on German, Spanish, Dutch and Chinese. The red bold curve represents the best model on the English dataset. \n\n![](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jMiTQD1jlsycSLCgPV0hfw.png \"Figure 1:  Aim’s Params plot for hundreds of fine-tuned models. Each curve corresponds to a single model with some hyperparameters and random seeds. Each vertical axis shows the model’s hyperparameters or the F1 scores for some language (German, Spanish, Dutch, Chinese, English).\")\n\nIt took us only a few clicks to see this key insight. \n\nAnd this makes a couple of hours of work into something that’s less than a minute.\n\n### Qualitative metrics comparison with Metrics Explorer\n\n#### Catastrophic Forgetting on the best Eng-based model\n\nIn our pursuit of understanding why models behave that way, we have tracked F1 scores across 60 epochs for the model that performs best on the English dataset. So, the Figure 2 below shows the behavior of F1 scores for 5 different languages (German, Spanish, Dutch, Chinese and English).\n\nThe red line on Figure 2 represents the evaluation on English data. Therefore, there is a clear difference in performance between the languages. Effectively Aim shows that the model overfits on English and what the ‘Catastrophic forgetting’ looks like. \n\nNotably, the Chinese (orange) gets worse faster than the other languages. Possibly because there are major linguistic differences between Chinese and the rest of the languages.\n\n![](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jTYunp3onfPgzAorAUed9A.png \"Figure 2: Visualization of the Catastrophic forgetting phenomenon. Evaluations on 5 languages development datasets for 60 epochs after fine-tuning the model on the English training data. The languages are English (red), Dutch (blue), German (green), Spanish (violet), and Chinese (orange).\")\n\n#### Proposed model selection algorithm analysis\n\nWe reproduce the paper in two phases. \n\n1. First, we have created candidate models by fine-tuning them on English labeled data. Then we checked their performance on the proposed 45 target languages.\n2.  Second, we are going to build the algorithm for model selection – proposed in the paper. After we will verify if it works better than the conventional methods.\n\n#### Analyzing the learning rates\n\nAim’s [Metric Explorer ](https://aimstack.io/aim3-1-images-tracker-and-images-explorer/)has allowed us to analyze the fine-tuning process through all the runs. In Figure 3, each line is a run with a specific target language, hyperparameter and random seed. Here we group runs by learning rate giving them the same color.\n\nWith Aim we frequently group runs into different charts. In this case we have grouped the metrics into charts by language . This allows us to visualize the fine-tuning with different learning rates per language.\n\n![](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ab3o77BJ0R8hbEezh7NrcA.png \"Figure 3: Visualization of the fine-tuning process with different learning rates and random seeds for Spanish, German, Chinese, Dutch and English languages.\")\n\nWith one more click, we aggregate runs of the same group (grouped by learning rate through all seeds). The aggregation helps us to see the trends of the F1 metrics collected across epochs. \n\nFrom Figure 4 it is clear that all models with very small learning rates (red) barely learn anything in 20 epochs.\n\n![](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jiam-hSc66ISC3deKgMoUg.png \"Figure 4: Visualization of the fine-tuning process aggregated by learning rates through different random seeds. Lines through highlighted intervals are medians from runs with different seeds. Each chart plots the fine-tuning process for a particular language (Spanish, German, Chinese, Dutch and English)\")\n\n## Learned Model Selection\n\nIn this paper the authors suggest an alternative strategy for model selection named Learned Model Selection (LMS). LMS is a neural network based model that learns to score the compatibility between a fine-tuned model and a target language. According to the paper, this method consistently selects better models than English development data across the 4 target languages.\n\nFor this final step we have also calculated the LMS scores for each model and have used Aim Params Explorer to compare the new and old methods for their efficiency. By just selecting the params and metrics we have produced the Figure 5 on Aim. Each highlighted curve in Figure 5 corresponds to one of the model candidates. With the old method (with the English axis) the best candidate F1 on the English axis is 0.699. On the other hand, if we select by the new algorithm (with LMS score axis), the F1 score would be 0.71, which is indeed higher than with the English candidate model.\n\n![](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G7Jpwdraw_XlSji_GTk2yA.png \"Figure 5: Visualization of the final process of model selection. The most left axis is the model number (like id) from 0 to 59. ‘F1 lang=”English”‘ is the F1 score on the English development data. ‘F1 lang=”German”‘ is the F1 score on the German test data. ‘LMS score’ is the ranking score provided by LMS, the algorithm proposed in the paper, the higher the better.\")\n\nWith [Aim](https://github.com/aimhubio/aim/) our experiments analysis at YerevaNN has become order of magnitude faster due to intuitive, beautiful and fast UI and the Aim explorers. The team at YerevaNN uses Aim on a daily basis.\n\nThanks to [Knarik Mheryan](https://medium.com/@knarik.mh) and [Hrant Khachatryan](https://medium.com/@hrantkhachatrian) for co-writing this blog post.\n\n- - -\n\n## Learn More\n\n[Aim is on a mission to democratize AI dev tools.](https://aimstack.readthedocs.io/en/latest/overview.html)\n\nWe have been incredibly lucky to get help and contributions from the amazing Aim community. It’s humbling and inspiring.\n\nTry out [Aim](https://github.com/aimhubio/aim), join the [Aim community](https://slack.aimstack.io/), share your feedback, open issues for new features, bugs.","html":"<p><a href=\"https://yerevann.com/\">YerevaNN</a> is a non-profit computer science and mathematics research lab based in Yerevan, Armenia. The lab’s main research interests are focused around machine learning algorithms and model selection, machine learning for biomedical data. YerevaNN also spends significant effort on supervision of student projects in order to support the up and coming Armenian scholars.</p>\n<p>YerevaNN collaborates with USC on DARPA grant projects — focused on low-resource learning problems, as well as with Meta AI for biomedical research, few-shot learning research. The lab has publications at Nature Scientific Data, ACL, NeurIPS, CVPR and WMT among others.</p>\n<p>We traditionally onboard new teammates with a task to reproduce a well-known paper. This allows us to both introduce our internal systems, codebase, resources as well as a great leeway into the problems they are going to focus on as part of their research. This is a story about how Knarik Mheryan has gotten started at YerevaNN and how <a href=\"https://github.com/aimhubio/aim\">Aim</a> has helped her in the process.</p>\n<h2>The challenges</h2>\n<h3>Model selection for cross-lingual transfer</h3>\n<p>Deep learning has enabled high-accuracy solutions to a wide variety of NLP tasks.These models are trained primarily on English corpora. Thus, they aren’t readily applicable or available for other human languages (due to the lack of labeled data). </p>\n<p>One approach to solve this problem is to pre-train a model on an unlabeled multilingual dataset in an unsupervised fashion. Then fine-tune it only on English labeled data for the given NLP task. It turns out the model’s performance on the target languages is strong, even though the model is fine-tuned only on English data.</p>\n<p>Model selection is a crucial step in this approach. When fine-tuning on English data with different hyperparams and seeds we are left with a set of models. The challenge is to select the model with the highest performance (e.g. F1 score) in the target language. </p>\n<p>In 2021, Yang Chen and Alan Ritter, have published a <a href=\"https://arxiv.org/abs/2010.06127\">paper</a> in EMNLP that tries to address this problem. Therefore, Knarik Mheryan’s first task at YerevaNN has been to reproduce this work as part of the <a href=\"https://paperswithcode.com/rc2021\">ML Reproducibility Challenge 2021</a>.</p>\n<h3>Reproducing the study</h3>\n<p>A common tactic has been to select models that perform well on the English data. This paper shows that the accuracy of models on English data does not always correlate well with the target language performance. To reproduce this, we have fine-tuned 240 models on a Named Entity Recognition task.</p>\n<p>The dimensionality of these experiments is high. So analyzing several 100 models is not a trivial task and it can take hours when comparing them with traditional tools. At YerevaNN we have been using <a href=\"https://aimstack.io/aim-foundations-why-we-re-building-a-tensorboard-alternative/\">Aim</a> as it allows us to compare 1000s of high-dimensional (all metrics, hyperparams and other metadata) experiments in a few clicks.</p>\n<h2>The solution</h2>\n<h3>Using Params Explorer to compare models</h3>\n<p>Params explorer allows us to directly compare the models with one view and with a few clicks. We have tracked the F1 scores for all models, languages. Using Aim’s <a href=\"https://aimstack.readthedocs.io/en/latest/understanding/concepts.html?highlight=context#sequence-context\">context</a> makes it easy to add additional metadata to the metrics (such as lang=”fr”) so there is no need to bake that data into the name. </p>\n<p>We have selected two hyperparameters of interest and F1 scores of 5 languages of interest. This one view shows all the models (each curve is a model) at once and we can compare them relative to selected hyperparams and metrics. (see Figure 1)</p>\n<p>More importantly, the plot below shows that the best performing model on English data (F1 lang=”en”) certainly doesn’t perform well on German, Spanish, Dutch and Chinese. The red bold curve represents the best model on the English dataset. </p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jMiTQD1jlsycSLCgPV0hfw.png\" alt=\"\" title=\"Figure 1:  Aim’s Params plot for hundreds of fine-tuned models. Each curve corresponds to a single model with some hyperparameters and random seeds. Each vertical axis shows the model’s hyperparameters or the F1 scores for some language (German, Spanish, Dutch, Chinese, English).\"></p>\n<p>It took us only a few clicks to see this key insight. </p>\n<p>And this makes a couple of hours of work into something that’s less than a minute.</p>\n<h3>Qualitative metrics comparison with Metrics Explorer</h3>\n<h4>Catastrophic Forgetting on the best Eng-based model</h4>\n<p>In our pursuit of understanding why models behave that way, we have tracked F1 scores across 60 epochs for the model that performs best on the English dataset. So, the Figure 2 below shows the behavior of F1 scores for 5 different languages (German, Spanish, Dutch, Chinese and English).</p>\n<p>The red line on Figure 2 represents the evaluation on English data. Therefore, there is a clear difference in performance between the languages. Effectively Aim shows that the model overfits on English and what the ‘Catastrophic forgetting’ looks like. </p>\n<p>Notably, the Chinese (orange) gets worse faster than the other languages. Possibly because there are major linguistic differences between Chinese and the rest of the languages.</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jTYunp3onfPgzAorAUed9A.png\" alt=\"\" title=\"Figure 2: Visualization of the Catastrophic forgetting phenomenon. Evaluations on 5 languages development datasets for 60 epochs after fine-tuning the model on the English training data. The languages are English (red), Dutch (blue), German (green), Spanish (violet), and Chinese (orange).\"></p>\n<h4>Proposed model selection algorithm analysis</h4>\n<p>We reproduce the paper in two phases. </p>\n<ol>\n<li>First, we have created candidate models by fine-tuning them on English labeled data. Then we checked their performance on the proposed 45 target languages.</li>\n<li> Second, we are going to build the algorithm for model selection – proposed in the paper. After we will verify if it works better than the conventional methods.</li>\n</ol>\n<h4>Analyzing the learning rates</h4>\n<p>Aim’s <a href=\"https://aimstack.io/aim3-1-images-tracker-and-images-explorer/\">Metric Explorer </a>has allowed us to analyze the fine-tuning process through all the runs. In Figure 3, each line is a run with a specific target language, hyperparameter and random seed. Here we group runs by learning rate giving them the same color.</p>\n<p>With Aim we frequently group runs into different charts. In this case we have grouped the metrics into charts by language . This allows us to visualize the fine-tuning with different learning rates per language.</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ab3o77BJ0R8hbEezh7NrcA.png\" alt=\"\" title=\"Figure 3: Visualization of the fine-tuning process with different learning rates and random seeds for Spanish, German, Chinese, Dutch and English languages.\"></p>\n<p>With one more click, we aggregate runs of the same group (grouped by learning rate through all seeds). The aggregation helps us to see the trends of the F1 metrics collected across epochs. </p>\n<p>From Figure 4 it is clear that all models with very small learning rates (red) barely learn anything in 20 epochs.</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jiam-hSc66ISC3deKgMoUg.png\" alt=\"\" title=\"Figure 4: Visualization of the fine-tuning process aggregated by learning rates through different random seeds. Lines through highlighted intervals are medians from runs with different seeds. Each chart plots the fine-tuning process for a particular language (Spanish, German, Chinese, Dutch and English)\"></p>\n<h2>Learned Model Selection</h2>\n<p>In this paper the authors suggest an alternative strategy for model selection named Learned Model Selection (LMS). LMS is a neural network based model that learns to score the compatibility between a fine-tuned model and a target language. According to the paper, this method consistently selects better models than English development data across the 4 target languages.</p>\n<p>For this final step we have also calculated the LMS scores for each model and have used Aim Params Explorer to compare the new and old methods for their efficiency. By just selecting the params and metrics we have produced the Figure 5 on Aim. Each highlighted curve in Figure 5 corresponds to one of the model candidates. With the old method (with the English axis) the best candidate F1 on the English axis is 0.699. On the other hand, if we select by the new algorithm (with LMS score axis), the F1 score would be 0.71, which is indeed higher than with the English candidate model.</p>\n<p><img src=\"https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G7Jpwdraw_XlSji_GTk2yA.png\" alt=\"\" title=\"Figure 5: Visualization of the final process of model selection. The most left axis is the model number (like id) from 0 to 59. ‘F1 lang=”English”‘ is the F1 score on the English development data. ‘F1 lang=”German”‘ is the F1 score on the German test data. ‘LMS score’ is the ranking score provided by LMS, the algorithm proposed in the paper, the higher the better.\"></p>\n<p>With <a href=\"https://github.com/aimhubio/aim/\">Aim</a> our experiments analysis at YerevaNN has become order of magnitude faster due to intuitive, beautiful and fast UI and the Aim explorers. The team at YerevaNN uses Aim on a daily basis.</p>\n<p>Thanks to <a href=\"https://medium.com/@knarik.mh\">Knarik Mheryan</a> and <a href=\"https://medium.com/@hrantkhachatrian\">Hrant Khachatryan</a> for co-writing this blog post.</p>\n<hr>\n<h2>Learn More</h2>\n<p><a href=\"https://aimstack.readthedocs.io/en/latest/overview.html\">Aim is on a mission to democratize AI dev tools.</a></p>\n<p>We have been incredibly lucky to get help and contributions from the amazing Aim community. It’s humbling and inspiring.</p>\n<p>Try out <a href=\"https://github.com/aimhubio/aim\">Aim</a>, join the <a href=\"https://slack.aimstack.io/\">Aim community</a>, share your feedback, open issues for new features, bugs.</p>"},"_id":"posts/how-new-yerevann-researchers-use-aim-to-compare-100s-of-models.md","_raw":{"sourceFilePath":"posts/how-new-yerevann-researchers-use-aim-to-compare-100s-of-models.md","sourceFileName":"how-new-yerevann-researchers-use-aim-to-compare-100s-of-models.md","sourceFileDir":"posts","contentType":"markdown","flattenedPath":"posts/how-new-yerevann-researchers-use-aim-to-compare-100s-of-models"},"type":"Post"}]},"__N_SSG":true}